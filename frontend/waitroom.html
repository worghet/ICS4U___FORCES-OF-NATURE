<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" href="/images/favicon.png" />
    <title>Forces of Nature - Waitroom</title>
    <style>
      /* General Styles */
      /* General Styles */
      html,
      body {
        height: 100%;
        width: 100%;
        margin: 0;
        padding: 0;
        font-family: "Arial", sans-serif;
        background-color: #1e1e2f; /* primary background colour */
        color: #ffffff;
        display: flex;
        flex-direction: column;
      }

      h1 {
        color: #00bcd4;
        margin: 0;
        font-size: 2em;
      }

      p {
        color: #b3b3b3;
        margin: 0;
        font-size: 1em;
      }

      /* Main Container */
      .main-container {
        display: flex;
        flex: 1;
        gap: 1em;
        padding: 1em;
        box-sizing: border-box;
      }

      /* Left + Middle Section */
      .left-middle {
        flex: 2;
        display: flex;
        flex-direction: column;
        gap: 1em;
      }

      /* Waitroom Header */
      .waitroom-header {
        text-align: center;
        padding: 1em;
        background-color: #2c2c3a; /* secondary background colour */
        border-radius: 0.5em;
      }

      /* Character Selection */
      .character-selection {
        display: flex;
        justify-content: space-around;
        gap: 1em;
      }

      .character-selection img {
        width: 20%; /* Relative width */
        max-width: 200px; /* Maximum size */
        height: auto; /* Maintain aspect ratio */
        border-radius: 0.5em;
        cursor: pointer;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
      }

      .character-selection img:hover {
        transform: scale(1.1);
        box-shadow: 0 0 1em rgba(0, 188, 212, 0.8);
      }

      /* Right Section */
      .right-section {
        flex: 1;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 1em;
        background-color: #2c2c3a; /* secondary background colour */
        padding: 1em;
        border-radius: 0.5em;
        overflow: hidden; /* Ensure the image doesn't overflow the container */
      }

      .selected-character {
        text-align: center;
        flex-grow: 1; /* Fill remaining space */
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        width: 100%;
        height: 100%; /* Ensure it takes the full height */
      }

      .selected-character img {
        width: 100%; /* Fill the container */
        max-width: 100%; /* Ensure it doesn't overflow */
        height: auto; /* Maintain aspect ratio */
        border-radius: 0.5em;
        object-fit: contain; /* Ensure the image fits within the container */
      }

      /* Player List */
      #player-list {
        list-style-type: none;
        padding: 0;
        margin: 0;
        flex-grow: 1;
        overflow-y: auto;
        max-height: 20vh; /* Scrollable area */
      }

      #player-list li {
        background-color: black;
        padding: 0.5em;
        margin: 0.5em 0;
        border-radius: 0.5em;
        text-align: center;
        transition: background-color 0.3s ease;
      }

      #player-list li.ready {
        outline: 2px solid green; /* Green outline for ready players */
        box-shadow: 0 0 10px green; /* Green glow for ready players */
      }

      #player-list li.not-ready {
        outline: 2px solid red; /* Red outline for not-ready players */
        box-shadow: 0 0 10px red; /* Red glow for not-ready players */
      }

      /* Buttons */
      .buttons {
        display: flex;
        justify-content: center;
        gap: 1em;
        margin-top: auto; /* Push buttons to the bottom */
      }

      button {
        background-color: #333;
        color: #fff;
        border: none;
        padding: 0.5em 1em;
        border-radius: 0.5em;
        cursor: pointer;
        font-size: 1em;
        transition: background-color 0.3s ease;
      }

      button:hover {
        background-color: #00bcd4;
      }

      button:disabled {
        background-color: #555;
        cursor: not-allowed;
      }

      /* Responsive Design */
      @media (max-width: 768px) {
        .main-container {
          flex-direction: column;
          padding: 0.5em;
        }

        .character-selection {
          flex-direction: column;
          align-items: center;
          gap: 0.5em;
        }

        .character-selection img {
          width: 50%; /* Larger images for smaller screens */
          max-height: fit-content; /* Smaller images for smaller screens */
        }

        .selected-character img {
          max-width: 150px; /* Smaller image for smaller screens */
        }

        #player-list {
          max-height: 15vh; /* Smaller scrollable area */
        }
      }

      @media (min-width: 1200px) {
        .character-selection img {
          width: 15%; /* Smaller images for larger screens */
        }

        .selected-character img {
          max-width: 300px; /* Larger image for larger screens */
        }
      }
    </style>
  </head>
  <body>
    <!-- Main Container -->
    <div class="main-container">
      <!-- Left + Middle Section -->
      <div class="left-middle">
        <!-- Waitroom Header -->
        <div class="waitroom-header">
          <h1>Waitroom</h1>
          <p>Choose a character, see who is here now, and get ready to play!</p>
        </div>

        <!-- Character Selection -->
        <div class="character-selection">
          <img
            src="../images/default_angler.png"
            alt="Angler"
            onclick="characterSelected(0)"
          />
          <img
            src="../images/default_golem.png"
            alt="Golem"
            onclick="characterSelected(1)"
          />
          <img
            src="../images/default_welder.png"
            alt="Welder"
            onclick="characterSelected(2)"
          />
        </div>

        <!-- Player List -->
        <h1>PLAYERS ONLINE:</h1>
        <ol id="player-list"></ol>

        <!-- Buttons -->
        <div class="buttons">
          <button onclick="backToMain()">Go back (leave lobby)</button>
          <button id="readyButton" onclick="toggleReady()">Ready</button>
          <button id="startGameButton" onclick="startGame()" disabled>
            Start game
          </button>
        </div>
      </div>

      <!-- Right Section -->
      <div class="right-section">
        <div class="selected-character">
          <h2 id="selected-username">Username</h2>
          <img id="selected-character-image" src="" alt="Selected Character" />
        </div>
      </div>
    </div>
    <script>
      // variables
      let gameStarted = false;
      let isReady = false; // Track player's readiness
      const playerList = document.getElementById("player-list");
      const selectedCharacterImage = document.getElementById(
        "selected-character-image"
      );
      const selectedUsername = document.getElementById("selected-username");
      const readyButton = document.getElementById("readyButton");
      const startGameButton = document.getElementById("startGameButton");

      const ANGLER_INDEX = 0;
      const GOLEM_INDEX = 1;
      const WELDER_INDEX = 2;

      const characterImages = {
        angler: {
          inactive: "../images/podium-angler-inactive.png",
          active: "../images/podium-angler-active.png",
        },
        golem: {
          inactive: "../images/podium-golem-inactive.png",
          active: "../images/podium-golem-active.png",
        },
        welder: {
          inactive: "../images/podium-welder-inactive.png",
          active: "../images/podium-welder-active.png",
        },
      };

      let selectedCharacter = null; // Track the selected character

      // Function to update the username display
      function updateUsername() {
        const username = sessionStorage.getItem("username") || "Username";
        selectedUsername.textContent = username;
      }

      // Function to toggle ready state
      function toggleReady() {
        isReady = !isReady; // Toggle readiness
        readyButton.textContent = isReady ? "Unready" : "Ready"; // Update button text

        // Update the selected character image based on readiness
        if (selectedCharacter !== null) {
          const characterKey =
            selectedCharacter === ANGLER_INDEX
              ? "angler"
              : selectedCharacter === GOLEM_INDEX
              ? "golem"
              : "welder";
          selectedCharacterImage.src = isReady
            ? characterImages[characterKey].active
            : characterImages[characterKey].inactive;
        }

        // Send readiness state to server
        fetch("/toggle-ready", {
          method: "POST",
          body: JSON.stringify({
            id: sessionStorage.getItem("playerId"),
            isReady: isReady,
          }),
        })
          .then(() => hasTheGameStarted()) // Refresh player list after toggling readiness
          .catch((error) =>
            console.error("Error toggling ready state:", error)
          );
      }

      // Function to check if all players are ready
      function checkAllPlayersReady(players) {
        return players.every((player) => player.isReady);
      }

      // Function to update the player list
      function updatePlayerList(players) {
        // Clear the existing list
        playerList.innerHTML = "";

        // Add each player to the list
        players.forEach((player) => {
          const listItem = document.createElement("li");
          const characterName =
            player.character === ANGLER_INDEX
              ? "Angler"
              : player.character === GOLEM_INDEX
              ? "Golem"
              : player.character === WELDER_INDEX
              ? "Welder"
              : "Unknown";

          listItem.classList.add(player.isReady ? "ready" : "not-ready");
          listItem.textContent = `${player.username} (${characterName})`;

          // Append the list item to the player list
          playerList.appendChild(listItem);
        });

        // Enable/disable the "Start Game" button based on readiness
        const allReady = checkAllPlayersReady(players);
        startGameButton.disabled = !allReady;
      }

      // Function to handle when the game starts
      function startGame() {
        gameStarted = true;
        alert("Game is starting!");
        // Additional logic for starting the game goes here
      }

      // Function to handle character selection
      function characterSelected(index) {
        selectedCharacter = index;
        updateCharacterSelection(index);
      }

      // Function to update the character image based on selection
      function updateCharacterSelection(index) {
        const characterKey =
          index === ANGLER_INDEX
            ? "angler"
            : index === GOLEM_INDEX
            ? "golem"
            : "welder";

        selectedCharacterImage.src = characterImages[characterKey].inactive;
      }

      // Function to update the player list and game state
      function hasTheGameStarted() {
        if (gameStarted) {
          // Logic to check the game status and display proper UI
        }
      }

      // Run the code to update the username when the page loads
      window.onload = () => {
        updateUsername();
        setInterval(hasTheGameStarted, 2000); // Fetch game state every 2 seconds
      };
    </script>
  </body>
</html>
